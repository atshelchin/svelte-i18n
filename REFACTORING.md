# src/lib ç›®å½•é‡æ„è·Ÿè¸ªæ–‡æ¡£

## ç›®æ ‡

é‡‡ç”¨æ›´å®ç”¨çš„ DDD åˆ†å±‚æ¶æ„ï¼Œå‡å°‘ç›®å½•åµŒå¥—ï¼Œæ¶ˆé™¤é‡å¤ä»£ç ï¼Œæé«˜å¯ç»´æŠ¤æ€§ã€‚

## é‡æ„åŸåˆ™

1. **æ¸è¿›å¼é‡æ„**ï¼šæ¯æ¬¡åªæ”¹åŠ¨ä¸€å°éƒ¨åˆ†
2. **ä¿æŒåŠŸèƒ½ä¸å˜**ï¼šæ‰€æœ‰ API å’ŒåŠŸèƒ½ä¿æŒä¸å˜
3. **æµ‹è¯•é©±åŠ¨**ï¼šæ¯æ­¥éƒ½è¦é€šè¿‡æ‰€æœ‰æµ‹è¯•
4. **åŠæ—¶æäº¤**ï¼šæ¯å®Œæˆä¸€æ­¥å°±æäº¤ä»£ç 

## ç›®æ ‡æ¶æ„

```
src/lib/
â”œâ”€â”€ core/                    # æ ¸å¿ƒåŸŸé€»è¾‘
â”‚   â”œâ”€â”€ i18n.ts             # ä¸»i18nå®ä¾‹å’Œé…ç½®
â”‚   â”œâ”€â”€ store.svelte.ts     # Svelteå“åº”å¼store
â”‚   â”œâ”€â”€ translator.ts       # ç¿»è¯‘æ ¸å¿ƒé€»è¾‘
â”‚   â”œâ”€â”€ formatter.ts        # æ ¼å¼åŒ–åŠŸèƒ½
â”‚   â””â”€â”€ types.ts            # æ ¸å¿ƒç±»å‹å®šä¹‰
â”‚
â”œâ”€â”€ services/               # åº”ç”¨æœåŠ¡å±‚
â”‚   â”œâ”€â”€ config.ts          # é…ç½®ç®¡ç†
â”‚   â”œâ”€â”€ loader.ts          # ç¿»è¯‘åŠ è½½å™¨
â”‚   â”œâ”€â”€ discovery.ts       # è‡ªåŠ¨å‘ç°
â”‚   â””â”€â”€ persistence.ts     # æŒä¹…åŒ–
â”‚
â”œâ”€â”€ utils/                  # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ locale.ts          # è¯­è¨€æ£€æµ‹å’Œå¤„ç†
â”‚   â”œâ”€â”€ path.ts            # è·¯å¾„å’ŒURLå¤„ç†
â”‚   â”œâ”€â”€ language-meta.ts   # è¯­è¨€å…ƒæ•°æ®
â”‚   â””â”€â”€ validation.ts      # éªŒè¯å·¥å…·
â”‚
â”œâ”€â”€ kit/                    # SvelteKité›†æˆ
â”‚   â”œâ”€â”€ load.ts            # ç»Ÿä¸€çš„loadå‡½æ•°
â”‚   â”œâ”€â”€ ssr.ts             # SSRç‰¹å®šé€»è¾‘
â”‚   â””â”€â”€ client.ts          # å®¢æˆ·ç«¯åˆå§‹åŒ–
â”‚
â”œâ”€â”€ components/             # UIç»„ä»¶
â”œâ”€â”€ cli/                    # CLIå·¥å…·
â”œâ”€â”€ tests/                  # æ‰€æœ‰æµ‹è¯•
â”œâ”€â”€ translations/           # åº“è‡ªèº«çš„ç¿»è¯‘
â”œâ”€â”€ types/                  # ç±»å‹å®šä¹‰
â””â”€â”€ index.ts               # ä¸»å…¥å£
```

## é‡æ„æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆå¹¶é‡å¤çš„ layout helper æ–‡ä»¶ âœ…

**ç›®æ ‡**ï¼šå°† `layout-helpers.ts`, `layout-load.ts`, `simple-layout.ts`, `layout-svelte-helper.ts` åˆå¹¶
**çŠ¶æ€**ï¼šå·²å®Œæˆ

#### åˆ†æ

- `layout-helpers.ts` - åŸºç¡€çš„ layout helper å‡½æ•°ï¼ˆè¢«å¯¼å‡ºä½¿ç”¨ï¼‰- 512è¡Œ
- `layout-load.ts` - ä¸»è¦çš„ loadI18nSSR å’Œ loadI18nClient å‡½æ•°ï¼ˆè¢«å¯¼å‡ºä½¿ç”¨ï¼‰- 488è¡Œ
- `simple-layout.ts` - ç®€åŒ–ç‰ˆçš„ load å‡½æ•°ï¼ˆæœªè¢«å¯¼å‡ºï¼‰- 420è¡Œ
- `layout-svelte-helper.ts` - Svelte ç»„ä»¶çš„ helperï¼ˆæœªè¢«å¯¼å‡ºï¼‰- 179è¡Œ

è¿™äº›æ–‡ä»¶æœ‰å¾ˆå¤šé‡å¤é€»è¾‘ï¼Œå¯ä»¥åˆå¹¶æˆä¸€ä¸ªç»Ÿä¸€çš„æ–‡ä»¶ã€‚

#### è¿›åº¦

âœ… 1. åˆ›å»ºæ–°çš„ `kit/load.ts` æ–‡ä»¶ä½œä¸ºç»Ÿä¸€å…¥å£
âœ… 2. æ›´æ–° `index.ts` ä½¿ç”¨æ–°çš„ `kit/load.ts`
âœ… 3. åˆ é™¤æœªä½¿ç”¨çš„æ–‡ä»¶ï¼š

- `simple-layout.ts` (420è¡Œ)
- `layout-svelte-helper.ts` (179è¡Œ)
- å…±åˆ é™¤ 599 è¡Œæœªä½¿ç”¨ä»£ç 
  âœ… 4. åˆ›å»ºåŠŸèƒ½åˆ†ææ–‡æ¡£ `docs/helper-analysis.md`
  âœ… 5. åˆ›å»ºå¯¹æ¯”åˆ†ææ–‡æ¡£ `docs/helper-comparison.md`
  âœ… 6. åˆ›å»ºç»Ÿä¸€çš„ SSR å®ç° `kit/ssr-load.ts`
- åˆå¹¶äº† `i18nServerLoad` å’Œ `loadI18nSSR` çš„åŠŸèƒ½
- ä¿ç•™äº†pathnameæ£€æµ‹åŠŸèƒ½
- ä¿æŒå‘åå…¼å®¹
  âœ… 7. æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ142ä¸ªå•å…ƒæµ‹è¯•ï¼Œ14ä¸ªe2eæµ‹è¯•ï¼‰
  âœ… 8. å®Œæˆæ‰€æœ‰å‡½æ•°è¿ç§»åˆ° kit ç›®å½•
  âœ… 9. åˆ é™¤ layout-helpers.ts å’Œ layout-load.ts (999è¡Œ)
  âœ… 10. åˆ›å»ºå®Œæ•´çš„ kit ç›®å½•ç»“æ„

### ç¬¬äºŒæ­¥ï¼šåˆ›å»º tests ç›®å½•å¹¶ç§»åŠ¨æµ‹è¯•æ–‡ä»¶ âœ…

**ç›®æ ‡**ï¼šå°†æ‰€æœ‰æµ‹è¯•æ–‡ä»¶ç§»åˆ°ç‹¬ç«‹çš„ tests ç›®å½•
**çŠ¶æ€**ï¼šå·²å®Œæˆ

#### è¿›åº¦

âœ… 1. åˆ›å»ºç»„ç»‡è‰¯å¥½çš„æµ‹è¯•ç›®å½•ç»“æ„ï¼š

- `src/lib/tests/unit/` - å•å…ƒæµ‹è¯•
- `src/lib/tests/integration/` - é›†æˆæµ‹è¯•
- `src/lib/tests/components/` - ç»„ä»¶æµ‹è¯•
  âœ… 2. ç§»åŠ¨äº†18ä¸ªæµ‹è¯•æ–‡ä»¶åˆ°åˆé€‚çš„ç›®å½•
  âœ… 3. æ›´æ–°äº†æ‰€æœ‰æµ‹è¯•å¯¼å…¥è·¯å¾„
  âœ… 4. æ‰€æœ‰æµ‹è¯•é€šè¿‡

### ç¬¬ä¸‰æ­¥ï¼šæ‰å¹³åŒ– domain/services åˆ° utils âœ…

**ç›®æ ‡**ï¼šå‡å°‘ç›®å½•åµŒå¥—ï¼Œå°† domain/services çš„å†…å®¹ç§»åˆ° utils
**çŠ¶æ€**ï¼šå·²å®Œæˆ

#### è¿›åº¦

âœ… 1. ç§»åŠ¨ `domain/services/utils.ts` â†’ `utils/translation-utils.ts`
âœ… 2. ç§»åŠ¨ `domain/services/language-meta.ts` â†’ `utils/language-meta.ts`
âœ… 3. æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„ï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰
âœ… 4. åˆ é™¤ç©ºçš„ `domain/services` ç›®å½•
âœ… 5. æ‰€æœ‰æµ‹è¯•é€šè¿‡

### ç¬¬å››æ­¥ï¼šé‡ç»„ infrastructure åˆ° services âœ…

**ç›®æ ‡**ï¼šå°† infrastructure ä¸‹çš„å†…å®¹é‡ç»„åˆ° services å’Œ utils
**çŠ¶æ€**ï¼šå·²å®Œæˆ

#### è¿›åº¦

âœ… 1. åˆ›å»º `services` ç›®å½•
âœ… 2. è¿ç§»æ–‡ä»¶ï¼š

- `infrastructure/loaders/auto-discovery-v2.ts` â†’ `services/discovery.ts`
- `infrastructure/loaders/built-in.ts` â†’ `services/loader.ts`
- `infrastructure/persistence/*.ts` â†’ `services/`
- `infrastructure/formatters/formatter.ts` â†’ `services/formatter.ts`
- `infrastructure/loaders/server-loader.ts` â†’ `services/server-loader.ts`
  âœ… 3. è¿ç§»åˆ° utilsï¼š
- `infrastructure/loaders/base-path.ts` â†’ `utils/base-path.ts`
- `infrastructure/loaders/app-languages.ts` â†’ `utils/app-languages.ts`
- `infrastructure/loaders/translation-utils.ts` â†’ `utils/translation-loader-utils.ts`
- `infrastructure/utils/*.ts` â†’ `utils/`
  âœ… 4. æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„ï¼ˆ19ä¸ªæ–‡ä»¶ï¼Œ33å¤„å¼•ç”¨ï¼‰
  âœ… 5. åˆ é™¤ç©ºçš„ `infrastructure` ç›®å½•
  âœ… 6. æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ154ä¸ªæµ‹è¯•ï¼‰

### ç¬¬äº”æ­¥ï¼šåˆ›å»º core ç›®å½•å¹¶é‡ç»„æ ¸å¿ƒé€»è¾‘ âœ…

**ç›®æ ‡**ï¼šå°†æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ç§»åˆ° core ç›®å½•
**çŠ¶æ€**ï¼šå·²å®Œæˆ

#### è¿›åº¦

âœ… 1. åˆ›å»º `core` ç›®å½•
âœ… 2. ç§»åŠ¨æ ¸å¿ƒæ–‡ä»¶ï¼š

- `application/stores/store.svelte.ts` â†’ `core/store.svelte.ts`
- `domain/models/types.ts` â†’ `core/types.ts`
- `application/stores/config-manager.ts` â†’ `core/config-manager.ts`
- `services/formatter.ts` â†’ `core/formatter.ts`ï¼ˆæ ¼å¼åŒ–æ˜¯æ ¸å¿ƒåŠŸèƒ½ï¼‰
  âœ… 3. æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„
  âœ… 4. åˆ é™¤ç©ºçš„ `application` å’Œ `domain` ç›®å½•
  âœ… 5. æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ154ä¸ªæµ‹è¯•ï¼‰

### ç¬¬å…­æ­¥ï¼šå®Œæˆ kit ç›®å½•æ•´åˆ âœ…

**ç›®æ ‡**ï¼šæ‰€æœ‰ SvelteKit ç‰¹å®šä»£ç ç§»åˆ° kit ç›®å½•
**çŠ¶æ€**ï¼šå·²å®Œæˆ

#### è¿›åº¦

âœ… 1. æ£€æŸ¥ç°æœ‰ kit ç›®å½•ç»“æ„
âœ… 2. ç§»åŠ¨ SvelteKit ç›¸å…³çš„å·¥å…·å‡½æ•°ï¼š

- `utils/pathname-locale.ts` â†’ `kit/pathname-locale.ts`
- `utils/url-locale.ts` â†’ `kit/url-locale.ts`
  âœ… 3. æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„ï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰
  âœ… 4. ä¿®å¤ package.json ä¸­çš„ build:cli è·¯å¾„
  âœ… 5. ä¿®å¤å…¶ä»–æ–‡ä»¶çš„ç±»å‹å¯¼å…¥è·¯å¾„
  âœ… 6. åˆ›å»º kit/README.md æ–‡æ¡£
  âœ… 7. æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ154ä¸ªæµ‹è¯•ï¼‰

### ç¬¬ä¸ƒæ­¥ï¼šåˆå¹¶ unified.ts å’Œ typed-unified.ts âœ…

**ç›®æ ‡**ï¼šæ¶ˆé™¤å‘½åæ··ä¹±ï¼Œåˆå¹¶ç›¸ä¼¼åŠŸèƒ½
**çŠ¶æ€**ï¼šå·²å®Œæˆ

#### è¿›åº¦

âœ… 1. åˆ†æä¸¤ä¸ªæ–‡ä»¶çš„åŠŸèƒ½é‡å 
âœ… 2. å°†ç±»å‹å®‰å…¨åŠŸèƒ½åˆå¹¶åˆ° unified.ts
âœ… 3. åˆ›å»º TypedI18nInstance æ¥å£æ”¯æŒæ³›å‹
âœ… 4. ä¸ºæ‰€æœ‰å‡½æ•°æ·»åŠ å¯é€‰çš„æ³›å‹å‚æ•°
âœ… 5. æ·»åŠ å‘åå…¼å®¹çš„å¯¼å‡º
âœ… 6. æ›´æ–°æ‰€æœ‰å¯¼å…¥è·¯å¾„ï¼ˆ5ä¸ªæ–‡ä»¶ï¼‰
âœ… 7. åˆ é™¤ typed-unified.ts
âœ… 8. æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ154ä¸ªæµ‹è¯•ï¼‰

### ç¬¬å…«æ­¥ï¼šæœ€ç»ˆæ¸…ç†å’Œä¼˜åŒ– ğŸš§

**ç›®æ ‡**ï¼šæ¸…ç†æœªä½¿ç”¨çš„ä»£ç ï¼Œä¼˜åŒ–å¯¼å‡º
**çŠ¶æ€**ï¼šè¿›è¡Œä¸­

#### è¿›åº¦

ğŸš§ 1. åˆ é™¤æ­»ä»£ç 
   - âœ… åˆ é™¤ `src/lib/application/services/namespace-example.ts`ï¼ˆæœªä½¿ç”¨ï¼‰
   - âœ… åˆ é™¤ `src/lib/application/services/namespace.ts`ï¼ˆæœªä½¿ç”¨ï¼‰
   - âœ… ç§»åŠ¨ `src/lib/application/services/typed-wrapper.ts` â†’ `src/lib/utils/typed-wrapper.ts`
   - âœ… åˆ é™¤ç©ºçš„ `application` ç›®å½•

ğŸš§ 2. æ‰“å¹³ç»„ä»¶ç›®å½•
   - âœ… ç§»åŠ¨ `src/lib/presentation/components/` â†’ `src/lib/components/`
   - âœ… æ›´æ–°æ‰€æœ‰ç»„ä»¶å¯¼å…¥è·¯å¾„ï¼ˆ3ä¸ªæ–‡ä»¶ï¼‰
   - âœ… åˆ é™¤ç©ºçš„ `presentation` ç›®å½•

â¸ï¸ 3. æµ‹è¯•éªŒè¯
   - âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡ï¼ˆ154ä¸ªæµ‹è¯•ï¼‰
   - âŒ 2ä¸ªe2eæµ‹è¯•å¤±è´¥ï¼ˆè¯­è¨€æŒä¹…åŒ–é—®é¢˜ï¼Œä¹‹å‰å·²å­˜åœ¨ï¼‰
   - â¸ï¸ éœ€è¦ä¿®å¤è¯­è¨€æŒä¹…åŒ–é—®é¢˜

## è¿›åº¦è®°å½•

### 2025-01-14

- åˆ›å»ºé‡æ„è®¡åˆ’æ–‡æ¡£
- å¼€å§‹ç¬¬ä¸€æ­¥ï¼šåˆ†æ layout helper æ–‡ä»¶
- åˆ›å»º `kit/load.ts` ä½œä¸ºç»Ÿä¸€å…¥å£
- åˆ é™¤2ä¸ªæœªä½¿ç”¨çš„ helper æ–‡ä»¶ï¼ˆ599è¡Œä»£ç ï¼‰
- åˆ›å»º helper åŠŸèƒ½åˆ†ææ–‡æ¡£
- åˆ›å»ºç»Ÿä¸€çš„ SSR å®ç° `kit/ssr-load.ts`
- æ·»åŠ å…¨é¢çš„ SSR åŠŸèƒ½æµ‹è¯•ï¼ˆ12ä¸ªæµ‹è¯•ç”¨ä¾‹ï¼‰
- ä¿®å¤æ‰€æœ‰ TypeScript ç±»å‹é—®é¢˜
- **æˆæœ**ï¼š
  - åˆ é™¤äº†599è¡Œæœªä½¿ç”¨çš„ä»£ç 
  - åˆ›å»ºäº†ç»Ÿä¸€çš„ SSR å®ç°ï¼Œä¿ç•™äº†pathnameæ£€æµ‹åŠŸèƒ½
  - å¢åŠ äº†æµ‹è¯•è¦†ç›–ç‡
  - ä¿®å¤äº†ç±»å‹ç³»ç»Ÿå…¼å®¹æ€§é—®é¢˜
  - æ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼ˆ142ä¸ªå•å…ƒæµ‹è¯•ï¼Œ14ä¸ªe2eæµ‹è¯•ï¼‰

---

_æ¯å®Œæˆä¸€æ­¥éƒ½ä¼šæ›´æ–°æ­¤æ–‡æ¡£_
